# QRLib API æ¥å£æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº† QRLib æä¾›çš„åç«¯ API æ¥å£ã€‚æ‰€æœ‰æ¥å£å‡è¿”å› JSON æ ¼å¼æ•°æ®ã€‚

**Base URL**: `http://localhost:3000` (é»˜è®¤)

---

## 1. è·å–é¢„è®¾åˆ—è¡¨ (Get Presets)

è·å–æ”¯æŒçš„ç™»å½•ç›®æ ‡é¢„è®¾åˆ—è¡¨ã€‚

-   **Endpoint**: `/api/presets`
-   **Method**: `GET`

### å“åº” (Response)

è¿”å›ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰å¯ç”¨é¢„è®¾ã€‚

```json
[
  {
    "key": "vip",
    "type": "qr",
    "name": "QQä¼šå‘˜ (VIP)",
    "description": "QQä¼šå‘˜å®˜ç½‘"
  },
  {
    "key": "miniprogram",
    "type": "mp",
    "name": "å°ç¨‹åºå¼€å‘ (DevTools)",
    "description": "QQå°ç¨‹åºå¼€å‘è€…å·¥å…·",
    "defaultAppId": ""
  },
  {
    "key": "farm",
    "type": "mp",
    "name": "QQç»å…¸å†œåœº (Farm)",
    "description": "QQç»å…¸å†œåœºå°ç¨‹åº"
  }
]
```

---

## 2. è·å–ç™»å½•äºŒç»´ç  (Create QR Code)

è¯·æ±‚ç”Ÿæˆä¸€ä¸ªæ–°çš„ç™»å½•äºŒç»´ç ã€‚

-   **Endpoint**: `/api/qr/create`
-   **Method**: `POST`
-   **Content-Type**: `application/json`

### è¯·æ±‚å‚æ•° (Request Body)

| å‚æ•°å | ç±»å‹ | å¿…é€‰ | æè¿° | ç¤ºä¾‹ |
| :--- | :--- | :--- | :--- | :--- |
| `preset` | string | å¦ | é¢„è®¾ Key (æ¥è‡ªæ¥å£ 1)ï¼Œé»˜è®¤ä¸º `vip` | `"vip"`, `"farm"` |

### å“åº” (Response)

```json
{
  "success": true,
  "qrsig": "xxxx...",           // äºŒç»´ç ç­¾å (æ ¸å¿ƒï¼Œç”¨äºæŸ¥è¯¢çŠ¶æ€)
  "qrcode": "data:image...",    // äºŒç»´ç å›¾ç‰‡çš„ Base64 æ•°æ® (ç›´æ¥ç”¨äº img src)
  "url": "https://...",         // äºŒç»´ç åŸå§‹å†…å®¹é“¾æ¥
  "isMiniProgram": false        // æ˜¯å¦ä¸ºå°ç¨‹åºæ¨¡å¼
}
```

---

## 3. æŸ¥è¯¢æ‰«ç çŠ¶æ€ (Check QR Status)

è½®è¯¢æŸ¥è¯¢äºŒç»´ç çš„æ‰«æå’Œç™»å½•çŠ¶æ€ã€‚**å»ºè®®è½®è¯¢é—´éš”ï¼š2-3ç§’**ã€‚

-   **Endpoint**: `/api/qr/check`
-   **Method**: `POST`
-   **Content-Type**: `application/json`

### è¯·æ±‚å‚æ•° (Request Body)

| å‚æ•°å | ç±»å‹ | å¿…é€‰ | æè¿° | ç¤ºä¾‹ |
| :--- | :--- | :--- | :--- | :--- |
| `qrsig` | string | **æ˜¯** | ä¸Šä¸€æ­¥è·å–çš„ `qrsig` | `"ptqrtoken_..."` |
| `preset` | string | å¦ | å½“å‰ä½¿ç”¨çš„é¢„è®¾ Key | `"vip"` |
| `appid` | string | å¦ | (ä»…é™å°ç¨‹åºæ¨¡å¼) è‡ªå®šä¹‰ AppID | `"1108291530"` |

### å“åº” (Response)

#### çŠ¶æ€ï¼šç­‰å¾…æ‰«ç  / æ‰«ç ä¸­
```json
{
  "success": true,
  "ret": "66",
  "msg": "ç­‰å¾…æ‰«ç ...",
  "code": "",
  "uin": "",
  "ticket": ""
}
```

#### çŠ¶æ€ï¼šå·²è¿‡æœŸ
```json
{
  "success": true,
  "ret": "65",
  "msg": "äºŒç»´ç å·²å¤±æ•ˆ",
  ...
}
```

#### çŠ¶æ€ï¼šç™»å½•æˆåŠŸ (Success) ğŸ‰
```json
{
  "success": true,
  "ret": "0",
  "msg": "ç™»å½•æˆåŠŸ",
  "code": "A1B2C3D4...",      // [æ ¸å¿ƒ] ç™»å½•æˆæƒç 
  "uin": "123456789",         // [æ ¸å¿ƒ] ç”¨æˆ· QQ å·
  "avatar": "https://...",    // [æ–°å¢] ç”¨æˆ·å¤´åƒ URL
  "ticket": "xxxx..."         // [å¯é€‰] ç¥¨æ® (å°ç¨‹åºæ¨¡å¼é€šå¸¸æœ‰)
}
```

---

## é”™è¯¯ä»£ç è¯´æ˜ (ret)

| ret | å«ä¹‰ | å¤„ç†å»ºè®® |
| :--- | :--- | :--- |
| `0` | æˆåŠŸ | åœæ­¢è½®è¯¢ï¼Œä¿å­˜å‡­è¯ |
| `66` | ç­‰å¾…ä¸­ | ç»§ç»­è½®è¯¢ |
| `65` | å¤±æ•ˆ/é”™è¯¯ | åœæ­¢è½®è¯¢ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°äºŒç»´ç  |
